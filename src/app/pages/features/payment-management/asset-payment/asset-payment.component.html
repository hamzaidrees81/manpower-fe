<nb-card>
    <nb-card-header class="custom-header">
        <nb-icon icon="credit-card-outline"></nb-icon>
        <span>Asset Payment Management</span>
    </nb-card-header>

    <nb-card-body>
        <!-- Search Filters + Buttons -->
        <div class="row mb-4" >
            <!-- Filter Section -->
            <div class="col-12">
              <div class="filter-section card shadow-sm border-0">
                <div class="card-header p-3">
                  <h4 class="mb-0 d-flex align-items-center">
                    <nb-icon icon="options-2-outline" class="me-2 mr-3"></nb-icon> Filters
                  </h4>
                </div>
                <div class="card-body">
                  <div class="row align-items-end">
                    
                    <!-- Search by Asset Name -->
                    <div class="col-md-3 col-sm-12 mb-3">
                      <label for="AssetSelect" class="fw-bold text-muted d-flex align-items-center">
                        <nb-icon icon="search-outline" class="me-2 mr-2"></nb-icon> Search by Asset Name
                      </label>
                      <select id="AssetSelect" class="form-control" [(ngModel)]="selectedAssetByName" (ngModelChange)="onAssetSelect('name')">
                        <option [ngValue]="null" disabled selected>Select an Asset</option>
                        <option *ngFor="let asset of assets" [ngValue]="asset">{{ asset.name }}</option>
                      </select>
                    </div>
          
                    <!-- Search by Asset Number -->
                    <div class="col-md-2 col-sm-12 mb-3">
                      <label for="AssetNumberSelect" class="fw-bold text-muted d-flex align-items-center">
                        <nb-icon icon="hash-outline" class="me-2 mr-2"></nb-icon> Search by Asset Number
                      </label>
                      <select id="AssetNumberSelect" class="form-control" [(ngModel)]="selectedAssetByNumber" (ngModelChange)="onAssetSelect('number')">
                        <option [ngValue]="null" disabled selected>Select Asset Number</option>
                        <option *ngFor="let asset of assets" [ngValue]="asset">{{ asset.assetNumber }}</option>
                      </select>
                    </div>
          
                    <!-- Select Date Range -->
                    <div class="col-md-3 col-sm-12 mb-3">
                      <label for="dateRangePicker" class="fw-bold text-muted d-flex align-items-center">
                        <nb-icon icon="calendar-outline" class="me-2 mr-2"></nb-icon> Select Date Range
                      </label>
                      <input nbInput placeholder="Select Date Range" class="form-control date-picker" [nbDatepicker]="rangepicker" [(ngModel)]="selectedDateRange">
                      <nb-rangepicker #rangepicker></nb-rangepicker>
                    </div>
          
                    <!-- Get Payment Button -->
                    <div class="col-md-2 col-sm-12 mb-3 text-center">
                      <button class="btn btn-success w-100 fw-bold shadow-sm" (click)="toggleDetails()" [disabled]="!selectedAssetByName && !selectedAssetByNumber">
                        <nb-icon icon="file-outline" class="me-2"></nb-icon> Get Payment
                      </button>
                    </div>
          
                    <!-- Reset Button -->
                    <div class="col-md-2 col-sm-12 mb-3 text-center">
                      <button class="btn btn-secondary w-100 fw-bold shadow-sm" (click)="resetAssetSelection()">
                        <nb-icon icon="undo-outline" class="me-2"></nb-icon> Reset
                      </button>
                    </div>
          
                  </div>
                </div>
              </div>
            </div>
          </div>
          
        <!-- Payment Details Section -->
        <div *ngIf="showPaymentTable" class="mt-4">
            <div class="section">
                <h5 class="fw-bold text-dark mb-3">
                    <i class="fas fa-file-invoice-dollar me-2 text-success mr-3"></i> Asset Payment Details
                </h5>

                <!-- Payment Table -->
                <ng2-smart-table [settings]="paymentTableSettings" [source]="paymentTableData"
                    class="mb-4 rounded shadow-sm table-responsive">
                </ng2-smart-table>

            </div>
        </div>

        <!-- Payment Input Section -->
        <div class="mt-4" *ngIf="showPaymentTable">
            <div class="section">
                <h5 class="fw-bold text-dark mb-3">
                    <i class="fas fa-credit-card me-2 text-primary mr-3"></i> Make a Payment
                </h5>

                <!-- Total & Pending Amounts -->
                <div class="row g-4 mb-4 mt-4">
                    <div class="mr-5 ml-3 d-flex justify-content-start">
                        <div class="text-end">
                            <label class="form-label fw-semibold text-muted">Total Amount</label>
                            <span class="form-control bg-light" style="border: none; color: green;">
                                {{ totalAmount | currency }}
                            </span>
                        </div>
                    </div>
                    <div class=" d-flex justify-content-start">
                        <div class="text-end">
                            <label class="form-label fw-semibold text-muted">Pending Amount</label>
                            <span class="form-control bg-light" style="border: none; color: red;">
                                {{ pendingAmount | currency }}
                            </span>
                        </div>
                    </div>
                </div>

                <div class="row g-4 mb-4 align-items-end">
                    <!-- Enter Amount Field -->
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Enter Amount</label>
                        <input class="form-control" [(ngModel)]="payAmount" type="number" placeholder="e.g. 5000" />
                    </div>
                    <!-- Comments Field -->
                    <div class="col-md-5">
                        <label class="form-label fw-bold">Comments (Optional)</label>
                        <input class="form-control" [(ngModel)]="payComment" placeholder="e.g. Paid partial amount" />
                    </div>
                    <!-- Pay Button -->
                    <div class="col-md-2">
                        <button class="btn btn-primary w-100 shadow-sm fw-bold" (click)="onPay()">
                            <i class="fas fa-check-circle me-1"></i> Pay
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payment History Section -->
        <div *ngIf="showHistoryTable" class="mt-4">
            <div class="section">
                <h5 class="fw-bold text-dark mb-3">
                    <i class="fas fa-history me-2 text-primary mr-3"></i> Payment History
                </h5>
                <ng2-smart-table [settings]="historyTableSettings" [source]="historyTableData"
                    class="rounded shadow-sm table-responsive">
                </ng2-smart-table>
            </div>
        </div>
    </nb-card-body>
</nb-card>