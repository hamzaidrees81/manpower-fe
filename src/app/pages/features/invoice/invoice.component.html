<nb-card>
  <nb-card-header class="custom-header d-flex align-items-center">
    <nb-icon icon="file-text-outline"></nb-icon>
    <span class="ms-2 fw-bold">{{title}}</span>
  </nb-card-header>

  <nb-card-body>
    <!-- Dropdowns: Client & Date Range (Side by Side on Large Screens) -->
    <div class="row mb-4" *ngIf="!(this.routedInvoiceData?.view === 'VIEW' || this.routedInvoiceData?.edit === 'EDIT')">
      <!-- Filter Section -->
      <div class="col-12">
        <div class="filter-section card shadow-sm">
          <div class="card-header">
            <h4 class="mb-0 d-flex align-items-center">
              <nb-icon icon="options-2-outline" class="me-2 mr-3"></nb-icon> Filters
            </h4>
          </div>
          <div class="card-body">
            <div class="row align-items-end">
              
              <!-- Client Selection -->
              <div class="col-md-2 col-sm-12 mb-3">
                <label for="clientSelect" class="fw-bold text-muted d-flex align-items-center">
                  <nb-icon icon="person-outline" class="me-2 mr-2"></nb-icon> Select client
                </label>
                <select id="clientSelect" class="form-control" [(ngModel)]="selectedClient" (ngModelChange)="onClientSelect()">
                  <option [ngValue]="null" disabled>Select a client</option>
                  <option *ngFor="let client of clients" [ngValue]="client">{{ client.name }}</option>
                </select>
              </div>
    
              <!-- Date Range Selection -->
              <div class="col-md-2 col-sm-12 mb-3">
                <label for="dateRangePicker" class="fw-bold text-muted d-flex align-items-center">
                  <nb-icon icon="calendar-outline" class="me-2 mr-2"></nb-icon> Select Date Range
                </label>
                <input nbInput placeholder="Select Date Range" class="form-control date-picker" [nbDatepicker]="rangepicker" [(ngModel)]="selectedDateRange">
                <nb-rangepicker #rangepicker></nb-rangepicker>
              </div>
    
              <!-- Prepare Invoice Button -->
              <div class="col-md-2 col-sm-12 mb-3 text-center">
                <button class="btn btn-success px-4  fw-bold w-100" (click)="toggleDetails()" [disabled]="!selectedClient || !selectedDateRange">
                  <i class="fas fa-file-invoice"></i> Prepare Invoice
                </button>
              </div>
    
            </div>
          </div>
        </div>
      </div>
    </div>
    
    
    

 

    <!-- Client Info Section -->
    <!-- <div *ngIf="selectedClient" class="client-info-card mt-4 p-3 border rounded shadow-sm bg-light">
      <h5 class="text-primary fw-bold text-center mb-2">{{ selectedClient.name }}</h5>
      <div class="d-flex justify-content-around text-secondary">
        <p><strong>Registration Date:</strong> {{ selectedClient.registrationDate }}</p>
        <p><strong>Last Invoice Date:</strong> {{ selectedClient.lastInvoice }}</p>
      </div>
    </div> -->

    <!-- Accordion for Project Details -->
    <div *ngIf="showDetails" class="mt-4">
      <nb-accordion>
        
        <!-- Generate an Accordion for Each Project -->
        <nb-accordion-item *ngFor="let project of invoiceData?.detailedProjectInvoiceList; let i = index">
          <nb-accordion-item-header>
            <i class="fas fa-project-diagram mr-2"></i> {{ project?.projectName }}
          </nb-accordion-item-header>
          <nb-accordion-item-body>
            
            <!-- Smart Table for Assets in the Project -->
            <ng2-smart-table [settings]="assetSettings" [source]="project?.assetInvoicesList"
              (editConfirm)="onAssetEdit($event,i,project?.projectId)"
              (deleteConfirm)="onAssetDelete($event, i,project?.projectId)">
            </ng2-smart-table>

          </nb-accordion-item-body>
        </nb-accordion-item>

      </nb-accordion>
    </div>


    <div class="row justify-content-center" *ngIf="!this.invoiceData?.detailedProjectInvoiceList || this.invoiceData?.detailedProjectInvoiceList?.length === 0">
      <div class="col-12 col-md-12 col-lg-12">
        <div class="card shadow-sm p-4 rounded">
          <div class="card-body text-center">
            <h2 class="card-title text-danger">No Records Found</h2>
            <p class="card-text text-muted mb-4">It seems like we couldn't find any records related to your query.</p>
            <!-- <button nbButton fullWidth (click)="goToHome()" type="button" class="btn btn-primary w-50">
              Take me to the Home Page
            </button> -->
          </div>
        </div>
      </div>
    </div>
    
    

        <!-- Summary Section -->
        <div class="container mt-4 p-3 bg-light rounded shadow-sm" *ngIf="showDetails">
          <h3 class="text-center fw-bold mb-3">Summary</h3>
          <div class="row g-3">
            <div  class="col-md-4">
              <div class="card text-center shadow-sm">
                <div class="card-body">
                  <p class="fw-bold text-secondary">Total Amount</p>
                  <span class="text-success fs-4">{{ summeryTotalAmount }}</span>
                </div>
              </div>
            </div>
            <div  class="col-md-4">
              <div class="card text-center shadow-sm">
                <div class="card-body">
                  <p class="fw-bold text-secondary">Total VAT Amount</p>
                  <span class="text-success fs-4">{{ totalWithVAT }}</span>
                </div>
              </div>
            </div>
            <div  class="col-md-4">
              <div class="card text-center shadow-sm">
                <div class="card-body">
                  <p class="fw-bold text-secondary">VAT Amount</p>
                  <span class="text-success fs-4">{{ vatAmount }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
    <!-- Submit Invoice Button -->
    <div *ngIf="showDetails && !(this.routedInvoiceData?.view === 'VIEW')" class="text-center mt-4">
      <button class="btn btn-primary px-4 py-2 fw-bold" (click)="submitInvoice()">
        <i class="fas fa-paper-plane"></i> Submit Invoice
      </button>
    </div>

  </nb-card-body>
</nb-card>
